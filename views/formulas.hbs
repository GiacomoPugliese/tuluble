<!DOCTYPE html>
<html>

    <head>
        {{#each project_data}}
        <title>{{project_name}} Formulas</title>
        {{/each}}
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <script type="text/javascript" src="/routes/projects.js"></script>
        <link rel="stylesheet" href="/partials/color.css">

    </head>
    <style>
        .container {
        display: flex;
        }
</style>

    <body style="display: flex; flex-direction: column;">
        
        <!-- NAVIGATION SIDEBAR -->
        <div style="display: flex; justify-content:space-between;">
            {{> navbar}}

           {{> logout}}
        </div>

        <div style="padding: 2% 2% 0% 2%">

        {{#each project_data}}
            <!-- https://materializecss.com/cards.html -->
                <div>
                    <h1>{{project_name}} Formulas </h1>
                    <p><b>Client:</b> {{this.client}}</p>
                    <p><b>Number of Formulas:</b> 2</p>
                </div>
        {{/each}}


        <div class="col s12 m4 l2">
            <a href="#open" class="btn waves-effect waves-luluble-pink luluble-pink modal-trigger">Add Trial</a>

            <div class="modal" id="open">
                <div style="padding: 5% 5% 5% 5%">
                    {{!-- <b><span>Add a New Ingredient</span></b> --}}
                    <h1 style="font-size:40px;">Add a New Trial</h1>

                    <form method="POST" action="/projects/{{project_id}}/formulaformsubmit">
                        <article class="regular">
                            {{!-- <h2>Textbook</h2> --}}

                            {{!-- Field 1 --}}
                            <b><label for="tuluble">Trial Number:</label></b>
                            <input type="number" name = "userInput1" id="userInput1" placeholder="Enter Trial Number" maxlength="20">
                            <p> </p>

                            {{!-- Field 2 --}}
                            <b><label for="tuluble">Formulator Name:</label></b>
                            <input type="text" name = "userInput2" id="userInput2" placeholder="Enter Formulator Name" maxlength="20">
                            <p> </p>

                            {{!-- Field 3 --}}
                            <b><label for="tuluble">Batch Date:</label></b>
                            <input type="date" name = "userInput3" id="userInput3" placeholder="Enter Batch Date" maxlength="20">
                            <p> </p>

                            <div class="add_button">
                                <button id = "add_button" type="submit">Add Trial</button>
                                {{!-- <a id="add_button" class="btn waves-effect waves-light luluble-pink">Add Ingredient</a> --}}
                            </div>
                            <p> </p>
                        </form>
                    
                
                    </article>
                </div>
            </div>
        </div>

         <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>


        {{!-- clicking new ingredient button --}}
        <script>
            $(document).ready(function() {
                $("#add_button").click(function() {
                var inputValue1 = $("#userInput1").val();
                var inputValue2 = $("#userInput2").val();
                var inputValue3 = $("#userInput3").val();

                window.location += "/formulaformsubmit";
                //$(window).attr("location", "inventoryformsubmit/" + inputValue1);
                });
            });
        </script>

        <script>
            $(document).ready(function () {
                $('.modal').modal();
            })
        </script>
        
                <div class="row">
                        <div class="col s6">
                            <ul class="tabs scrollable" id = "one">
                                {{#each formula_data}}
                                    <li class="tab col s3"><a href="/trial{{trial_num}}">Trial {{trial_num}}</a></li>
                                {{/each}}
                            </ul>
                        </div>

                        <div class="col s6">
                            <ul class="tabs" id = "two">
                                {{#each formula_data}}
                                    <li class="tab col s3"><a href="/trial{{trial_num}}">Trial {{trial_num}}</a></li>
                                {{/each}}
                            </ul>
                        </div>

                <script>
                    $(document).ready(function(){
                        $('.tabs').tabs();
                    });
                </script>

                <script>
                    $(document).ready(function() {
                        //window.location.href += "/trial/{{trial_num}}"
    
                        /* $('#one').click(function() {
                            console.log("Active Tab ONE Div:"+$(".active").attr('href'));
                        });  

                        $('#two').click(function() {
                            console.log("Active Tab TWO Div:"+$(".active").attr('href'));
                        });   */

                        // SOMETHING HERE (OR IN APP.JS CHANGES) MADE THE TABS STOP WORKING. ONCE THOSE WORK TEST THAT THE HREFS ARE CORRECT
                        $("#one").click(function (e) {
                            var id = $(e.target).attr("href");
                            console.log("HELLO");


                            console.log(id);

                            let ref = window.location.href.split("/");
                            let p_id = ref[4];
                            let val2 = ref[5];

                            console.log(val2);
                            console.log(p_id);
                            console.log(ref);

                            let newRef = "projects/" + p_id + id + "/" + val2;
    
                            // FIGURE OUT HOW TO CHANGE, NOT JUST ADD ON
                            window.location.pathname = newRef;

                            
                        });

                        $("#two").click(function (e) {
                            var id = $(e.target).attr("href");

                            let ref = window.location.href.split("/");
                            let p_id = ref[4];
                            let val1 = ref[5];

                            let newRef = "projects/" + p_id + "/" + val1 + id;

                            window.location.pathname = newRef;

                        });

                        
                    });
                                  
                </script>
                
                <div class="row">
                <div style="overflow-x: scroll;" class = "col s12 m4 l6">
                    <table class="scrollable">
                        <tr>
                            <th>Phase</th>
                            <th>Ingredient</th>
                            <th>INCI</th>
                            <th style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Lot Number</th>
                            <th style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">% of Ingredient</th>
                            <th style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Total Amt of Ing</th>
                        </tr>
                        {{#each trialData1}}
                            <p>Batch date: {{batch_date}}</p>
                            <p>Formulator: {{formulator}}</p>
                        {{/each}}
                        {{#each trial_data1}}
                            <p>Total Amt of Formula: {{s}}</p>
                            <p class = "totalPercent">WARNING: Total Percentage = {{percent}}</p>
                        {{/each}}
                            <a href = "/projects/{{project_id}}/procedure{{trial_num1}}">Procedure</a>
                        


                        {{#each formula_ingredient_data1}}
                            <tr>
                                <td>{{phase}}</td>
                                <td>{{trade_name}}</td>
                                <td>{{inci_name}}</td>
                                <td>{{lot_num}}</td>
                                <td>{{percent_of_ingredient}}</td>
                                <td>{{total_amount}}</td>
                            </tr>
                        {{/each}}
                    
                    <td>
                        <div class="col s12 m4 l2">
                        <a href="#openIng" class="btn waves-effect waves-luluble-pink luluble-pink modal-trigger">Add Phase</a>

                        <div class="modal" id="openIng">
                            <div style="padding: 5% 5% 5% 5%">
                                {{!-- <b><span>Add a New Ingredient</span></b> --}}
                                <h1 style="font-size:40px;">Add a New Phase</h1>

                                {{!-- somehow get the formula of the tab clicked on --}}
                                
                                <form method="POST" action="/projects/{{project_id}}/{{#each trialData1}}{{formula_id}}{{/each}}/phaseformsubmit">
                                
                                    <article class="regular">
                                        {{!-- <h2>Textbook</h2> --}}

                                        {{!-- Field 1 --}}
                                        <b><label for="tuluble">Phase:</label></b>
                                        <input type="text" name = "userInput1" id="userInput1" placeholder="Enter Phase Name" maxlength="20">
                                        <p> </p>

                                        {{!-- Field 2 --}}
                                        <b><label for="tuluble">Ingredient:</label></b>
                                        {{!-- <input type="text" name = "userInput2" id="userInput2" placeholder="Enter Ingredient Name" maxlength="20"> --}}
                                        <select name="userInput2" id="userInput2" class="browser-default">
                                            <option value="0" disabled selected>Choose your ingredient</option>
                                            {{#each inventory_data}}
                                                <option value="{{ingredient_id}}">{{inci_name}} (LOT {{lot_num}})</option>
                                            {{/each}}
                                        </select>
                                        <p> </p>

                                        <b><label for="tuluble">Percent of Ingredient:</label></b>
                                        <input type="number" name = "userInput3" id="userInput3" placeholder="Enter Percent" maxlength="20">
                                        <p> </p>

                                        <b><label for="tuluble">Total Amount of Ingredient:</label></b>
                                        <input type="number" name = "userInput4" id="userInput4" placeholder="Enter Total Amount" maxlength="20">
                                        <p> </p>

                                        <div class="add_trial_button">
                                            <button id = "add_trial_button" type="submit">Add Ingredient</button>
                                            {{!-- <a id="add_button" class="btn waves-effect waves-light luluble-pink">Add Ingredient</a> --}}
                                        </div>
                                        <p> </p>
                                    </form>
                                </article>
                            </div>
                        </div>
                        </div>
                    </td>
                    
                    <td>
                        <div class="col s12 m4 l2">
                        <a href="#makeTrial" class="btn waves-effect waves-luluble-pink luluble-pink modal-trigger">MAKE TRIAL</a>
                        <div class="modal" id="makeTrial">
                            <div style="padding: 5% 5% 5% 5%">
                                {{!-- <b><span>Add a New Ingredient</span></b> --}}
                                <h1 style="font-size:40px;">Make Trial {{trial_num}}</h1>

                                {{!-- somehow get the formula of the tab clicked on --}}
                                <form method="POST" action="/projects/{{project_id}}/trial{{trial_num1}}/makeformsubmit">
                                    <article class="regular">
                                        {{!-- <h2>Textbook</h2> --}}

                                        {{!-- Field 1 --}}
                                        {{!-- <b><label for="tuluble">Quantity ({{unit}}):</label></b>
                                        <input type="range" min = "0" max = "100" name = "userInput1" id="userInput1">
                                        <p> </p> --}}
                                        {{!-- USE MATH IN SQL TO FIND MAX VAL --}}

                                        <b><label for="tuluble">Quantity ({{unit}}):</label></b>
                                        <input type="number" name = "userInput1" id="userInput1">
                                        <p> </p>

                                       
                                        <div class="make_trial_button">
                                            <button id = "make_trial_button" type="submit">Make Trial</button>
                                            {{!-- <a id="add_button" class="btn waves-effect waves-light luluble-pink">Add Ingredient</a> --}}
                                        </div>
                                        <p> </p>
                                    </form>
                                </article>
                            </div>
                        </div>
                    </td>

                    </table>

                </div>

                {{!-- find a way to make the href trial#1/trial#2 to show what each of the tabs have selected --}}
        
                
                <div style="overflow-x: scroll;" id="2trial{{trial_num}}" class = "col s12 m4 l6">
                    <table class="scrollable">
                        <tr>
                            <th>Phase</th>
                            <th>Ingredient</th>
                            <th>INCI</th>
                            <th style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Lot Number</th>
                            <th style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">% of Ingredient</th>
                            <th style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Total Amt of Ing</th>
                        </tr>
                            {{#each trialData2}}
                                <p>Batch date: {{batch_date}}</p>
                                <p>Formulator: {{formulator}}</p>
                            {{/each}}
                            {{#each trial_data2}}
                                <p>Total Amt of Formula: {{s}}</p>
                                <p class = "totalPercent">WARNING: Total Percentage = {{percent}}</p>
                            {{/each}}
                                <a href = "/projects/{{project_id}}/procedure{{trial_num2}}">Procedure</a>
                                {{!-- <script>
                                    var tp = document.getElementByClassName("totalPercent");
                                    if ({{percent}} != 100) {
                                        tp.innerHTML = "WARNING: Total Percentage is NOT 100%"
                                    }
                                </script> --}}
                                
                           

                            {{#each formula_ingredient_data2}}
                            <tr>
                                <td>{{phase}}</td>
                                <td>{{trade_name}}</td>
                                <td>{{inci_name}}</td>
                                <td>{{lot_num}}</td>
                                <td>{{percent_of_ingredient}}</td>
                                <td>{{total_amount}} {{unit}}</td>
                            </tr>
                            {{/each}}
                    <td>

                        

                        <div class="col s12 m4 l2">
                        <a href="#openIng2" class="btn waves-effect waves-luluble-pink luluble-pink modal-trigger">Add Phase</a>

                        <div class="modal" id="openIng2">
                            <div style="padding: 5% 5% 5% 5%">
                                {{!-- <b><span>Add a New Ingredient</span></b> --}}
                                <h1 style="font-size:40px;">Add a New Phase</h1>
                                
                                    <form method="POST" action="/projects/{{project_id}}/{{#each trialData2}}{{formula_id}}{{/each}}/phaseformsubmit">
                                
                                    <article class="regular">
                                        {{!-- <h2>Textbook</h2> --}}

                                        {{!-- Field 1 --}}
                                        <b><label for="tuluble">Phase:</label></b>
                                        <input type="text" name = "userInput1" id="userInput1" placeholder="Enter Phase Name" maxlength="20">
                                        <p> </p>

                                        {{!-- Field 2 --}}
                                        <b><label for="tuluble">Ingredient:</label></b>
                                        {{!-- <input type="text" name = "userInput2" id="userInput2" placeholder="Enter Ingredient Name" maxlength="20"> --}}
                                        <select name="userInput2" id="userInput2" class="browser-default">
                                            <option value="0" disabled selected>Choose your ingredient</option>
                                            {{#each inventory_data}}
                                                <option value="{{ingredient_id}}">{{inci_name}} (LOT {{lot_num}})</option>
                                            {{/each}}
                                        </select>
                                        <p> </p>

                                        <b><label for="tuluble">Percent of Ingredient:</label></b>
                                        <input type="number" name = "userInput3" id="userInput3" placeholder="Enter Percent" maxlength="20">
                                        <p> </p>

                                        <b><label for="tuluble">Total Amount of Ingredient:</label></b>
                                        <input type="number" name = "userInput4" id="userInput4" placeholder="Enter Total Amount" maxlength="20">
                                        <p> </p>

                                        <div class="add_trial_button2">
                                            <button id = "add_trial_button2" type="submit">Add Ingredient</button>
                                            {{!-- <a id="add_button" class="btn waves-effect waves-light luluble-pink">Add Ingredient</a> --}}
                                        </div>
                                        <p> </p>
                                    </form>
                                
                            
                                </article>
                            </div>
                        </div>
                    </div>
                    </td>

                    <td>
                        <div class="col s12 m4 l2">
                        <a href="#makeTrial2" class="btn waves-effect waves-luluble-pink luluble-pink modal-trigger">MAKE TRIAL</a>
                        <div class="modal" id="makeTrial2">
                            <div style="padding: 5% 5% 5% 5%">
                                {{!-- <b><span>Add a New Ingredient</span></b> --}}
                                <h1 style="font-size:40px;">Make Trial {{trial_num}}</h1>

                                {{!-- somehow get the formula of the tab clicked on --}}
                                <form method="POST" action="/projects/{{project_id}}/trial{{trial_num2}}/makeformsubmit">
                                    <article class="regular">
                                        {{!-- <h2>Textbook</h2> --}}

                                        {{!-- Field 1 --}}
                                        <b><label for="tuluble">Quantity ({{unit}}):</label></b>
                                        <input type="range" min = "0" max = "100" name = "userInput1" id="userInput1">
                                        <p> </p>
                                        {{!-- USE MATH IN SQL TO FIND MAX VAL --}}

                                       
                                        <div class="make_trial_button">
                                            <button id = "make_trial_button2" type="submit">Make Trial</button>
                                            {{!-- <a id="add_button" class="btn waves-effect waves-light luluble-pink">Add Ingredient</a> --}}
                                        </div>
                                        <p> </p>
                                    </form>
                                </article>
                            </div>
                        </div>
                    </td>

                    <td>
                        <div class="col s12 m4 l2">
                        <a href="#printTrial2" class="btn waves-effect waves-luluble-pink luluble-pink modal-trigger">PRINT TRIAL</a>
                        <div class="modal" id="makeTrial2">
                            <div style="padding: 5% 5% 5% 5%">
                                {{!-- <b><span>Add a New Ingredient</span></b> --}}
                                <h1 style="font-size:40px;">Print Trial {{trial_num}}</h1>

                                {{!-- somehow get the formula of the tab clicked on --}}
                                <form method="POST" action="/projects/{{project_id}}/trial{{trial_num2}}/makeformsubmit">
                                    <article class="regular">
                                        {{!-- <h2>Textbook</h2> --}}

                                        {{!-- Field 1 --}}
                                        <b><label for="tuluble">Quantity {{unit}}:</label></b>
                                        <p class="range-field">
                                            <input type="range" name = "userInput1" id="userInput1" min="0" max="100" />
                                        </p>
                                        <p> </p>
                                        {{!-- USE MATH IN SQL TO FIND MAX VAL --}}

                                       
                                        <div class="make_trial_button">
                                            <button id = "make_trial_button2" type="submit">Make Trial</button>
                                            {{!-- <a id="add_button" class="btn waves-effect waves-light luluble-pink">Add Ingredient</a> --}}
                                        </div>
                                        <p> </p>
                                    </form>
                                </article>
                            </div>
                        </div>
                    </td>

                    </table>
                </div>

                </div>
                </div>


                <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
                <script
                    src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"> 
                </script>

                {{!-- <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            console.log("HELLOOO");
                            const inputField = document.querySelector('.autocomplete');
                            M.autocomplete.init(inputField, {
                                data:{
                                    'Google': null, // null instead of images
                                    'Yahoo': null,
                                    'Youtube': null
                                },
                                limit:10,
                                minlength:2
                            });
                        });
                    </script> --}}

                    <script>
                        $(document).ready(function() {
                            $("#add_trial_button").click(function() {
                            var inputValue1 = $("#userInput1").val();
                            var inputValue2 = $("#userInput2").val();
                            var inputValue3 = $("#userInput3").val();
                            var inputValue4 = $("#userInput4").val();

                            window.location.href += "/phaseformsubmit";
                            //$(window).attr("location", "inventoryformsubmit/" + inputValue1);
                            });
                        });
                    </script>

                    <script>
                        $(document).ready(function() {
                            $("#add_trial_button2").click(function() {
                            var inputValue1 = $("#userInput1").val();
                            var inputValue2 = $("#userInput2").val();
                            var inputValue3 = $("#userInput3").val();

                            window.location += "/phaseformsubmit";
                            //$(window).attr("location", "inventoryformsubmit/" + inputValue1);
                            });
                        });
                    </script>

                    <script>
                        $(document).ready(function() {
                            $("#make_trial_button").click(function() {
                            var inputValue1 = $("#userInput1").val();
                          
                            window.location += "makeformsubmit";
                            //$(window).attr("location", "inventoryformsubmit/" + inputValue1);
                            });
                        });
                    </script>

                    <script>
                        $(document).ready(function() {
                            $("#make_trial_button2").click(function() {
                            var inputValue1 = $("#userInput1").val();
                          

                            window.location += "makeformsubmit";
                            //$(window).attr("location", "inventoryformsubmit/" + inputValue1);
                            });
                        });
                    </script>

                    <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            var elems = document.querySelectorAll('#userInput2');
                            var options = {
                            data: {
                                // Replace 'data' below with the actual data from your mySQL database
                                {{#each inventory_data}}
                                    "{{inci_name}}": null,
                                {{/each}}
                            }
                            };
                            var instances = M.Autocomplete.init(elems, options);
                        });
                    </script>
            


            </div>

        </div>


        

    </body>

</html>